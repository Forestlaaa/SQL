# This file is for leetcode SQL, mySQL
# Mostly the upper part code is written by myself, the lower part code is the official solution.

# 183. Customers Who Never Order

Select c.name AS customers
From Customers c left join Orders o
on c.id = o.customerId
where o.customerId is NULL

select customers.name as 'Customers'
from customers
where customers.id not in
(
    select customerid from orders  # !Never write such things before in SQLite
);

# 1873. Calculate Special Bonus
# Write an SQL query to calculate the bonus of each employee. The bonus of an employee is 100% of their salary if the ID of the employee is an odd number 
# and the employee name does not start with the character 'M'. The bonus of an employee is 0 otherwise.
# Return the result table ordered by employee_id.

SELECT employee_id
,case
    WHEN employee_id % 2 <> 0 AND substr(name, 1, 1) <> "M" THEN salary
    Else 0
END bonus
From Employees
Order by employee_id ASC

select employee_id , salary * ( employee_id%2 ) * ( name not like 'M%') as bonus  # !Use wildcard 
from employees
order by employee_id;

# update: 627. Swap Salary
UPDATE Salary 
set
    sex = case sex
        when "m" then "f"
        else "m"
        end;
        
# !!!DELETE 196. Delete Duplicate Emails:  delete all the duplicate emails, keeping only one unique email with the smallest id.
## Use self join

DELETE a from Person a
    , Person b
Where a.email = b.email AND a.id > b.id

DELETE FROM Person WHERE Id NOT IN 
(SELECT * FROM(
    SELECT MIN(Id) FROM Person GROUP BY Email) as p);
    
    
# 1667. Fix Names in a Table: Write an SQL query to fix the names so that only the first character is uppercase and the rest are lowercase.
## Pay attention: In Mysql, concatenate use function concat(), while in sqlite, use ||, in SQL server, use "+"

Select user_id
, concat(Upper(substr(name, 1, 1)), Lower(substr(name, 2))) AS name
From Users
Order by user_id ASC


# !!!1484. Group Sold Products By The Date: Write an SQL query to find for each date the number of different products sold and their names.
# The sold products names for each date should be sorted lexicographically.
# Return the result table ordered by sell_date.

## Points: 1. Use DISTINCT  2. use Group_concat to concatenate the values from multiple rows into a single string and returns it.
## Syntax:
GROUP_CONCAT(DISTINCT expression
    ORDER BY expression
    SEPARATOR sep);

## code
Select sell_date
, count(DISTINCT product) AS num_sold
, Group_concat(DISTINCT product 
        order by product ASC
        separator ',' ) as products
From Activities
Group by sell_date
Order by sell_date
